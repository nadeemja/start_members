<?php
//Help function
function start_members_help($path, $arg) {
	
	$output = '';
	
	switch ($path){
	
		case "admin/help#start_members":
			
			$output = '<p>'. t("Help side for start members") .'</p>';
			
			break;
	
	} 
	
	return $output;
	
}// function start_members_help

//Set perimissions
function start_members_perm() {

	return array('access start members');
	
} // function start_members_perm()

//define block
function start_members_block($op = 'list', $delta = 0, $edit = array()){

	//Define blocks
	if ($op == "list"){
		
		$block = array();
		$block[0]["info"] = t("Memberlist Block");
	}

}//function _block

//define page
function start_members_all(){

	
	//This variable comes from the domain-access module and tells us the current domain
	global $_domain;
	
	//init content
	$page_content = '<table>';
	$page_content .= dpm($_domain);
	
	//alternate query
	$q = db_query("
					SELECT 
						users.uid, name, mail, is_admin, node.nid, og_description, title 
					
					FROM 
						users, og_uid, og, node
					
					WHERE 
						users.uid = og_uid.uid 
						AND og_uid.nid = og.nid 
						AND og.nid = node.nid 
						#AND node.uid != users.uid 
					
				");
		
	//Loop and add to page_content
	while ($user = db_fetch_array($q)){
		
		//get user profile field values
		$q2 = db_query("
						SELECT
							fid, value, uid
						FROM
							profile_values
						
						WHERE
							profile_values.uid = $user[uid]
						AND fid IN (6,2,3)
					");
		
		while ($profile_values = db_fetch_array($q2))
			{
			
			switch($profile_values["fid"]){
				
				case 2:
					$user["first_name"] = $profile_values["value"];
				break;
				
				case 3:
					$user["last_name"] = $profile_values["value"];
				break;
				
				case 6:
					$user["date_of_birth"] = print_r(unserialize($profile_values["value"]));
				break;
				
			}
			
			$user = array_merge($user, $profile_values);	
		}
		
		//convert array keys to variables
		foreach($user as $key=>$value) { $$key = $value; }
			
		$page_content .= dpm($user);
		$page_content .= "<tr><td>$first_name</td><td>$last_name</td><td>$date_of_birth</td><td>$title</td><td></td></tr>";	
		
	}
	
	//close table
	$page_content .= "</table>";

	return $page_content;
}//_all()

//Menu links
function start_members_menu(){
	
	$items = array();
	
	//all page
	$items['start_members'] = array(
		'title' 			=> 'Start members',
		'page callback' 	=> 'start_members_all',
		'access arguments' 	=> array('access start members'),
		'type'				=> MENU_CALLBACK
	);
	
	return $items;
}
